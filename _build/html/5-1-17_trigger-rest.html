

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.1.17 Trigger (REST) &mdash; GridDB-Docs  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5.1.18 Trigger (JMS)" href="5-1-18_trigger-jms.html" />
    <link rel="prev" title="5.1.16 TQL" href="5-1-16_tql.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <img src="_static/logo.png"><a href="index.html"> GridDB-Docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-1_what-is-griddb.html">1.1 What is GridDB?</a></li>
<li class="toctree-l1"><a class="reference internal" href="1-2_griddb-edition.html">1.2 GridDB Editions</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-1_system-requirements.html">2.1 System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-2_installation.html">2.2 Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-3_run-your-first-griddb-node-cluster.html">2.3 Run your First GridDB Node/Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-4_run-a-sample-java-client-app.html">2.4 Run a Sample Java Client App</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-1_griddb-technical-overview.html">3.1 GridDB Technical Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-2_key-container-model.html">3.2 Key Container Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-3_tql.html">3.3 TQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-4_crud-operations.html">3.4 CRUD Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-5_transactions-and-acid.html">3.5 Transactions and ACID</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-6_indexes.html">3.6 Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-7_storage-architecture.html">3.7 Storage Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-8_replication-distribution.html">3.8 Replication &amp; Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-9_sharding.html">3.9 Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-1_data-modeling-basics.html">4.1 Data Modeling Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-2_data-modeling-using-griddb.html">4.2 Data Modeling Using GridDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-3_modeling-relationships.html">4.3 Modeling Relationships</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-4_possibilities-and-variations-of-data-models-in-griddb.html">4.4 Possibilities and Variations of Data Models in GridDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-1_introduction.html">5.1.1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-2_griddb-basics.html">5.1.2 GridDB Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-3_prepare-server.html">5.1.3 Preparation: Environment (server)</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-4_prepare-client.html">5.1.4 Preparation: Environment (client)</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-5_connection.html">5.1.5 Preparation: Connecting to GridDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-6_container-schema.html">5.1.6 Schema definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-7_container-create-drop.html">5.1.7 Container Creation and Deletion</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-8_collection-register.html">5.1.8 Collection Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-9_collection-retrieve.html">5.1.9 Data Retrieval</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-10_collection-delete.html">5.1.10 Data Deletion</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-11_collection-modify.html">5.1.11 Collection Modification</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-12_timeseries-register.html">5.1.12 Data Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-13_timeseries-retrieve.html">5.1.13 Data Retrieval</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-14_timeseries-delete.html">5.1.14 TimeSeries Data Deletion</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-15_timeseries-modify.html">5.1.15 TimeSeries Container Modification</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-16_tql.html">5.1.16 TQL</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5.1.17 Trigger (REST)</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-18_trigger-jms.html">5.1.18 Trigger (JMS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-19_multiput.html">5.1.19 Multi-Put</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-20_multiquery.html">5.1.20 Multi-Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-1-21_multiget.html">5.1.21 Multi-Get</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-1_supported-os-platforms-and-system-requirements.html">6.1 Supported OS, Platforms and System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-2_sizing-and-scaling.html">6.2 Sizing and Scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-3_installing.html">6.3 Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-4_upgrading-the-editions.html">6.4 Upgrading the Editions</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-5_migration-from-other-databases.html">6.5 Migration from Other Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-6_cluster-administration-operations.html">6.6 Cluster Administration &amp; Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-7_monitoring-troubleshooting.html">6.7 Monitoring &amp; Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-8_tuning.html">6.8 Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="7-1_jdbc-connector.html">7.1 JDBC Connector</a></li>
<li class="toctree-l1"><a class="reference internal" href="7-2_odbc-connector.html">7.2 ODBC Connector</a></li>
<li class="toctree-l1"><a class="reference internal" href="7-3_hadoop-and-spark-connector.html">7.3 Hadoop and Spark Connector</a></li>
<li class="toctree-l1"><a class="reference internal" href="7-4_grafana-connector.html">7.4 Grafana Connector*</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GridDB-Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>5.1.17 Trigger (REST)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/5-1-17_trigger-rest.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>Table of Contents</p>
<div class="section" id="trigger-rest">
<span id="trigger-rest"></span><h1>5.1.17 Trigger (REST)<a class="headerlink" href="#trigger-rest" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<span id="overview"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This chapter describes how to notify events by REST method in trigger function.</p>
</div>
<div class="section" id="trigger-function">
<span id="trigger-function"></span><h2>Trigger function<a class="headerlink" href="#trigger-function" title="Permalink to this headline">¶</a></h2>
<p>A trigger function is an automatic notification function when an operation (add/update or delete) is carried out on the row data of a container. Event notifications can be received without the need to poll and monitor the database by application.</p>
<p>There are 2 ways of notifying events to the application.</p>
<ul class="simple">
<li>REST</li>
<li>Java Messaging Service (JMS)</li>
</ul>
<p>Here we describe how to notify the events by REST method.</p>
</div>
<div class="section" id="setting-the-trigger">
<span id="setting-the-trigger"></span><h2>Setting the Trigger<a class="headerlink" href="#setting-the-trigger" title="Permalink to this headline">¶</a></h2>
<p>Following information should be set to notify events by REST method.</p>
<p><strong>Table.1 Trigger settings (REST)</strong></p>
<p>Item</p>
<p>Description</p>
<p>Name</p>
<p>Trigger name.</p>
<p>Trigger type</p>
<p><code class="docutils literal notranslate"><span class="pre">TriggerInfo.Type.REST</span></code></p>
<p>Notification condition</p>
<p><code class="docutils literal notranslate"><span class="pre">TriggerInfo.EventType.PUT</span></code> or <code class="docutils literal notranslate"><span class="pre">TriggerInfo.EventType.DELETE</span></code></p>
<p>Notification destination URI</p>
<p>It should be described in the following format. (method name)://(host name):(port number)/(path)</p>
<p><strong>List.1 Setting the Trigger</strong> (TriggerRest.java)</p>
<p>// Create Trigger Settings
TriggerInfo trigger = new TriggerInfo();
trigger.setName(“InstrumentLogRESTTrigger”);
trigger.setType(Type.REST);
trigger.setTargetEvents(EnumSet.of(EventType.PUT));
trigger.setURI(URI.create(“http://127.0.0.1/api”));</p>
<p>// Get TimeSeries Container
TimeSeries<InstrumentLog> logTs =
store.getTimeSeries(“weather_station_1”, InstrumentLog.class);</p>
<p>logTs.createTrigger(trigger);</p>
<p>// Update Data for call Trigger
SimpleDateFormat format = new SimpleDateFormat(“yyyy/MM/dd HH:mm”, Locale.US);
InstrumentLog log = logTs.get(format.parse(“2016/07/02 12:00”));
log.temperture = 90;
ogTs.put(log);</p>
<ul class="simple">
<li>L.33: Instantiate the <code class="docutils literal notranslate"><span class="pre">TriggerInfo</span></code> which represents the trigger setting.</li>
<li>L.34−37: Set trigger properties in Table.1</li>
<li>L.43: Set <code class="docutils literal notranslate"><span class="pre">TriggerInfo</span></code> into Timeseries Container. Not only Timeseries Container, but also Collection could be used for trigger function.</li>
<li>L.46-49: Update the Timeseries Container to enable trigger notification.</li>
</ul>
</div>
<div class="section" id="rest-server-startup">
<span id="rest-server-startup"></span><h2>REST server startup<a class="headerlink" href="#rest-server-startup" title="Permalink to this headline">¶</a></h2>
<p>You need to prepare the REST server to receive notifications. In this sample, we will show you how to run the simple Web server in Python which can be used to display the logs.</p>
<p><strong>List.2 REST Server Script</strong> (restserver.py)</p>
<p>import sys
import json
from BaseHTTPServer import BaseHTTPRequestHandler, HTTPServer</p>
<p>class JsonResponseHandler(BaseHTTPRequestHandler):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">content_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">))</span>
    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_len</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
    <span class="n">jsonBody</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsonBody</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/json&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</pre></div>
</div>
<p>server = HTTPServer((‘’, 80), JsonResponseHandler)
server.serve_forever()</p>
<p>This REST server can be run by executing the command below.</p>
<p><strong>List.3 Run REST Server Script</strong></p>
<p>$ sudo python restserver.py</p>
<p>Please note that you should run the REST server on the machine which represents notification destination URI.</p>
</div>
<div class="section" id="result-of-the-trigger-execution">
<span id="result-of-the-trigger-execution"></span><h2>Result of the Trigger execution<a class="headerlink" href="#result-of-the-trigger-execution" title="Permalink to this headline">¶</a></h2>
<p>You can see the result below on REST server when <code class="docutils literal notranslate"><span class="pre">TriggerRest.java</span></code> is executed.</p>
<p><strong>List.4 Result of Update the Row</strong></p>
<p>{
“container”: “weather_station_1”,
“event”: “put”
}
gsnode2.griddb_default - - [13/Sep/2016 10:18:01] “POST /api HTTP/1.1” 200 -</p>
<p>In this case, Container <code class="docutils literal notranslate"><span class="pre">weather_station_1</span></code> exists in <code class="docutils literal notranslate"><span class="pre">gsnode2.griddb_default</span></code> and you can see the the notification content.</p>
</div>
<div class="section" id="source-code">
<span id="source-code"></span><h2>Source Code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>Complete source code used in this sample can be downloaded from the following.</p>
<p>Download: <a class="reference external" href="img/trigger-rest.zip">trigger-rest.zip</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="5-1-18_trigger-jms.html" class="btn btn-neutral float-right" title="5.1.18 Trigger (JMS)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="5-1-16_tql.html" class="btn btn-neutral" title="5.1.16 TQL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, GridDB.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #39A7D1;
    }
  </style>


</body>
</html>